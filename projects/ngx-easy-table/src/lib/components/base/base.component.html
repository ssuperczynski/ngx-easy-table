<div
  class="ngx-container"
  [class.bg-dark]="config.tableLayout.theme === 'dark'"
  (dragenter)="dragEnter($event)"
  (dragover)="dragOver($event)"
  (dragleave)="dragLeave($event)"
  (drop)="drop($event)"
>
  <table
    [id]="id"
    #table
    class="table"
    [class.table-sm]="config.tableLayout.style === 'tiny'"
    [class.table-borderless]="config.tableLayout.borderless"
    [class.table-dark]="config.tableLayout.theme === 'dark'"
    [class.table-hover]="config.tableLayout.hover"
    [class.table-striped]="config.tableLayout.striped"
    [class.ngx-table__horizontal-scroll]="config.horizontalScroll && !config.isLoading"
  >
    <thead
      [class.ngx-infinite-scroll-viewport-thead]="config.infiniteScroll"
      table-thead
      [config]="config"
      [selectAllTemplate]="selectAllTemplate"
      [filtersTemplate]="filtersTemplate"
      [additionalActionsTemplate]="additionalActionsTemplate"
      [columns]="columns"
      [headerActionTemplates]="headerActionTemplates"
      (selectAll)="onSelectAll()"
      (event)="emitEvent($event.event, $event.value)"
    ></thead>
    <tbody *ngIf="rows && !config.isLoading">
      <ng-container *ngIf="rowTemplate">
        <ng-container *ngIf="!config.infiniteScroll">
          <ng-container
            *ngFor="let row of rows | paginate: modifiers.pagination; trackBy: trackRowByIndex"
          >
            <tr
              [cdkContextMenuTriggerFor]="contextMenu"
              (click)="onClick($event, row, '', null, row.index)"
              (dblclick)="onDoubleClick($event, row, '', null, row.index)"
              [class.ngx-table__table-row--selected]="
                row.index === selectedRow && !config.selectCell
              "
            >
              <ng-template #contextMenu>
                <div class="ngx-menu" cdkMenu>
                  <ng-container
                    [ngTemplateOutlet]="rowContextMenu"
                    [ngTemplateOutletContext]="{ $implicit: { row: row, rowId: row.index } }"
                  >
                  </ng-container>
                </div>
              </ng-template>
              <ng-container
                [ngTemplateOutlet]="rowTemplate"
                [ngTemplateOutletContext]="{ $implicit: row, index: row.index }"
              >
              </ng-container>
              <td *ngIf="config.detailsTemplate">
                <span
                  class="ngx-icon"
                  *ngIf="config.showDetailsArrow ?? true"
                  [ngClass]="row.isCollapsed ? 'ngx-icon-arrow-down' : 'ngx-icon-arrow-right'"
                  (click)="collapseRow(row.index)"
                >
                </span>
              </td>
            </tr>
            <tr *ngIf="(config.detailsTemplate && row.isCollapsed) || config.collapseAllRows">
              <td [attr.colspan]="columns.length + 1">
                <ng-container
                  [ngTemplateOutlet]="detailsTemplate"
                  [ngTemplateOutletContext]="{ $implicit: row, index: row.index }"
                >
                </ng-container>
              </td>
            </tr>
          </ng-container>
        </ng-container>
        <cdk-virtual-scroll-viewport
          itemSize="50"
          *ngIf="config.infiniteScroll"
          class="ngx-infinite-scroll-viewport"
        >
          <ng-container *cdkVirtualFor="let row of rows; let rowIndex = index">
            <tr
              (click)="onClick($event, row, '', null, rowIndex)"
              (dblclick)="onDoubleClick($event, row, '', null, rowIndex)"
              [class.ngx-table__table-row--selected]="
                rowIndex === selectedRow && !config.selectCell
              "
            >
              <ng-container
                [ngTemplateOutlet]="rowTemplate"
                [ngTemplateOutletContext]="{ $implicit: row, index: rowIndex }"
              >
              </ng-container>
              <td *ngIf="config.detailsTemplate">
                <span
                  class="ngx-icon"
                  *ngIf="config.showDetailsArrow ?? true"
                  [ngClass]="row.isCollapsed ? 'ngx-icon-arrow-down' : 'ngx-icon-arrow-right'"
                  (click)="collapseRow(rowIndex)"
                >
                </span>
              </td>
            </tr>
            <tr *ngIf="(config.detailsTemplate && row.isCollapsed) || config.collapseAllRows">
              <td [attr.colspan]="columns.length + 1">
                <ng-container
                  [ngTemplateOutlet]="detailsTemplate"
                  [ngTemplateOutletContext]="{ $implicit: row, index: rowIndex }"
                >
                </ng-container>
              </td>
            </tr>
          </ng-container>
        </cdk-virtual-scroll-viewport>
      </ng-container>
      <ng-container *ngIf="!rowTemplate">
        <ng-container *ngIf="!config.infiniteScroll">
          <ng-container
            *ngFor="let row of rows | paginate: modifiers.pagination; trackBy: trackRowByIndex"
          >
            <tr
              [class.ngx-table__table-row--selected]="
                row.index === selectedRow && !config.selectCell
              "
              [ngClass]="row.classList"
              [style]="row.styles"
            >
              <td *ngIf="config.checkboxes">
                <label>
                  <input
                    type="checkbox"
                    class="form-check-input"
                    id="checkbox-{{ row.index }}"
                    [checked]="isSelected || row.checkboxSelected"
                    (change)="onCheckboxSelect($event, row.index)"
                  />
                </label>
              </td>
              <td *ngIf="config.radio">
                <label>
                  <input
                    type="radio"
                    id="radio-{{ row.index }}"
                    name="radio"
                    class="form-check-input"
                    [checked]="row.radioSelected"
                    (change)="onRadioSelect(row.index)"
                  />
                </label>
              </td>
              <ng-container
                *ngFor="let column of columns; let colIndex = index; trackBy: trackColumnByKey"
              >
                <td
                  [cdkContextMenuTriggerFor]="contextMenu"
                  (click)="onClick($event, row, column.key, colIndex, row.index)"
                  (dblclick)="onDoubleClick($event, row, column.key, colIndex, row.index)"
                  [class.pinned-left]="column.pinned"
                  [ngClass]="row.cellClasses ? row.cellClasses[column.key] : ''"
                  [ngStyle]="{ 'left.px': column.pinned ? 150 * colIndex : null }"
                  [class.ngx-table__table-col--selected]="
                    colIndex === selectedCol && !config.selectCell
                  "
                  [class.ngx-table__table-cell--selected]="
                    colIndex === selectedCol &&
                    row.index === selectedRow &&
                    !config.selectCol &&
                    !config.selectRow
                  "
                >
                  <ng-template #contextMenu>
                    <div class="ngx-menu" cdkMenu>
                      <ng-container
                        [ngTemplateOutlet]="rowContextMenu"
                        [ngTemplateOutletContext]="{
                          $implicit: {
                            row: row,
                            rowId: row.index,
                            key: column.key,
                            colId: colIndex
                          }
                        }"
                      >
                      </ng-container>
                    </div>
                  </ng-template>
                  <div *ngIf="!column.cellTemplate">{{ row | render: column.key }}</div>
                  <ng-container
                    *ngIf="cellTemplates[column.key]"
                    [ngTemplateOutlet]="cellTemplates[column.key]"
                    [ngTemplateOutletContext]="{
                      $implicit: row,
                      rowIndex: row.index,
                      column: column
                    }"
                  >
                  </ng-container>
                </td>
              </ng-container>
              <td *ngIf="config.additionalActions || config.detailsTemplate">
                <span
                  class="ngx-icon"
                  *ngIf="config.showDetailsArrow ?? true"
                  [ngClass]="row.isCollapsed ? 'ngx-icon-arrow-down' : 'ngx-icon-arrow-right'"
                  (click)="collapseRow(row.index)"
                >
                </span>
              </td>
            </tr>
            <tr *ngIf="(config.detailsTemplate && row.isCollapsed) || config.collapseAllRows">
              <td *ngIf="config.checkboxes || config.radio"></td>
              <td [attr.colspan]="columns.length + 1">
                <ng-container
                  [ngTemplateOutlet]="detailsTemplate"
                  [ngTemplateOutletContext]="{ $implicit: row, index: row.index }"
                >
                </ng-container>
              </td>
            </tr>
          </ng-container>
        </ng-container>
        <!-- infinite scroll -->
        <cdk-virtual-scroll-viewport
          itemSize="50"
          *ngIf="config.infiniteScroll"
          class="ngx-infinite-scroll-viewport"
        >
          <ng-container *cdkVirtualFor="let row of rows; let rowIndex = index">
            <tr
              [class.ngx-table__table-row--selected]="
                rowIndex === selectedRow && !config.selectCell
              "
            >
              <td *ngIf="config.checkboxes" width="3%">
                <label>
                  <input
                    type="checkbox"
                    class="form-check-input"
                    id="checkbox-infinite-scroll-{{ rowIndex }}"
                    [checked]="isSelected || row.checkboxSelected"
                    (change)="onCheckboxSelect($event, rowIndex)"
                  />
                </label>
              </td>
              <td *ngIf="config.radio" width="3%">
                <label>
                  <input
                    type="radio"
                    id="radio-infinite-scroll-{{ rowIndex }}"
                    name="radio"
                    class="form-check-input"
                    [value]="row.radioSelected"
                    (change)="onRadioSelect(rowIndex)"
                  />
                </label>
              </td>
              <ng-container
                *ngFor="let column of columns; let colIndex = index; trackBy: trackColumnByKey"
              >
                <td
                  (click)="onClick($event, row, column.key, colIndex, rowIndex)"
                  (dblclick)="onDoubleClick($event, row, column.key, colIndex, rowIndex)"
                  [class.pinned-left]="column.pinned"
                  [ngClass]="row.cellClasses ? row.cellClasses[column.key] : ''"
                  [ngStyle]="{ 'left.px': column.pinned ? 150 * colIndex : null }"
                  [class.ngx-table__table-col--selected]="
                    colIndex === selectedCol && !config.selectCell
                  "
                  [class.ngx-table__table-cell--selected]="
                    colIndex === selectedCol &&
                    rowIndex === selectedRow &&
                    !config.selectCol &&
                    !config.selectRow
                  "
                >
                  <div *ngIf="!column.cellTemplate">{{ row | render: column.key }}</div>
                  <ng-container
                    *ngIf="cellTemplates[column.key]"
                    [ngTemplateOutlet]="cellTemplates[column.key]"
                    [ngTemplateOutletContext]="{
                      $implicit: row,
                      rowIndex: rowIndex,
                      column: column
                    }"
                  >
                  </ng-container>
                </td>
              </ng-container>
              <td *ngIf="config.additionalActions || config.detailsTemplate">
                <span
                  class="ngx-icon"
                  *ngIf="config.showDetailsArrow ?? true"
                  [ngClass]="row.isCollapsed ? 'ngx-icon-arrow-down' : 'ngx-icon-arrow-right'"
                  (click)="collapseRow(rowIndex)"
                >
                </span>
              </td>
            </tr>
            <tr *ngIf="(config.detailsTemplate && row.isCollapsed) || config.collapseAllRows">
              <td *ngIf="config.checkboxes || config.radio"></td>
              <td [attr.colspan]="columns.length + 1">
                <ng-container
                  [ngTemplateOutlet]="detailsTemplate"
                  [ngTemplateOutletContext]="{ $implicit: row, index: rowIndex }"
                >
                </ng-container>
              </td>
            </tr>
          </ng-container>
        </cdk-virtual-scroll-viewport>
      </ng-container>
    </tbody>
    <tbody *ngIf="rows.length === 0">
      <tr class="ngx-table__body-empty">
        <ng-container *ngIf="noResultsTemplate" [ngTemplateOutlet]="noResultsTemplate">
        </ng-container>
        <td [attr.colspan]="columns && columns.length + 1" *ngIf="!noResultsTemplate">
          <div class="ngx-table__table-no-results">No results</div>
        </td>
      </tr>
    </tbody>
    <tbody *ngIf="config.isLoading">
      <tr class="ngx-table__body-loading">
        <ng-container *ngIf="loadingTemplate" [ngTemplateOutlet]="loadingTemplate"> </ng-container>
        <td [attr.colspan]="columns && columns.length + 1" *ngIf="!loadingTemplate">
          <div [style.height.px]="loadingHeight" class="ngx-table__table-loader-wrapper">
            <div class="ngx-table__table-loader"></div>
          </div>
        </td>
      </tr>
    </tbody>
    <tfoot *ngIf="summaryTemplate">
      <tr>
        <ng-container
          [ngTemplateOutlet]="summaryTemplate"
          [ngTemplateOutletContext]="{
            total: rows.length,
            limit: modifiers.pagination.itemsPerPage,
            page: modifiers.pagination.currentPage
          }"
        >
        </ng-container>
      </tr>
    </tfoot>
  </table>
  <mat-paginator
    *ngIf="config.paginationEnabled"
    [length]="modifiers.pagination.filteredCollectionSize"
    [pageSize]="modifiers.pagination.itemsPerPage"
    [pageIndex]="modifiers.pagination.currentPage"
    [hidePageSize]="!config.paginationRangeEnabled"
    (page)="paginationEvent($event)"
    [pageSizeOptions]="[5, 10, 25, 100]"
  >
  </mat-paginator>
</div>
